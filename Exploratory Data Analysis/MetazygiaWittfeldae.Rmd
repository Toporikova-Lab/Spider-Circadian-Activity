---
title: "MetazygiaWittfeldae"
output: html_document
---

```{r}
library("TTR")
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library("pivottabler")
library("tidyverse")
library(tibble)
library("lubridate") 
library(sqldf)
```

```{r}
MetWit1LD<-read.csv("Metazygia wittfeldae Monitor 1 Updated_LD.csv", header=TRUE)
MetWit1DD<-read.csv("Metazygia wittfeldae Monitor 1 Updated_DD.csv", header=TRUE)
MetWit2LD<-read.csv("Metazygia wittfeldae Monitor 2 Updated_LD.csv", header=TRUE)
MetWit2DD<-read.csv("Metazygia wittfeldae Monitor 2 Updated_LD.csv", header=TRUE)
```

```{r}
#function to binarise data and split Date.Time column (aka clean the data)
cleaningData<-function(df){
  maxColNum<-ncol(df)
  df[,3:maxColNum]<-ifelse(df[,3:maxColNum]>0,1,0)
  df$Date<-as.Date(df$Date.Time)
  df$Time <- format(as.POSIXct(df$Date.Time), format = "%H:%M:%S")
  df<-df%>%
    select(Date.Time, Light, Date, Time, everything())
  return(df)
}

#function to calculate time difference
calculatingTimeDiff<-function(restToMovedf, moveToRestdf, newColName){
  df<-sqldf("SELECT startTime, stopTime FROM restToMovedf LEFT JOIN moveToRestdf USING(number)")
  df$timediff<-as.numeric(difftime(df$stopTime,df$startTime))
  df<-df%>%
    filter(timediff>2)%>%
    select(timediff)
  return (df)
}

#Cleaning data for all the dataframes
MetWit1LDclean<-cleaningData(MetWit1LD)
MetWit1DDclean<-cleaningData(MetWit1DD)
MetWit2LDclean<-cleaningData(MetWit2LD)
MetWit2DDclean<-cleaningData(MetWit2DD)
```


```{r}
#test function for column
findMovement<-function(df, columnname){
  for (i in seq(nrow(df)-2)){
    if (df$columnname[i]==1 &
        df$columnname[i+2]==1 &
        df$columnname[i+1]==0){
      df$columnname[i+1]<-1
        }
  }
}
findMovement(df=MetWit1LDclean, columnname="Monitor.1.Spider.4")
MetWit1LDclean
```



```{r}
#MetWit1DDclean Spider 1
for (i in seq(nrow(MetWit1DDclean)-2)) {
  if (MetWit1DDclean$Monitor.1.Spider.1[i] == 1 & 
        MetWit1DDclean$Monitor.1.Spider.1[i+2] == 1 &
        MetWit1DDclean$Monitor.1.Spider.1[i+1] == 0) {
    MetWit1DDclean$Monitor.1.Spider.1[i+1] <- 1
  }
}

#start time
MetWit1DDrestToMove1<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.1,Date.Time)%>%
  filter(Monitor.1.Spider.1-lag(Monitor.1.Spider.1)>=1)%>%
  rename(startTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(startLight=Light)

#function that shows from Move to Rest ( the minute where there is no movement)
#stop time
MetWit1DDmoveToRest1<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.1,Date.Time)%>%
  filter(Monitor.1.Spider.1-lag(Monitor.1.Spider.1)<0)%>%
  rename(stopTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(stopLight=Light)

#uses the function calculatingTimeDiff to find the time difference and filter values and stores as another data frame
MetWit1DDmovement1<-calculatingTimeDiff(MetWit1DDrestToMove1, MetWit1DDmoveToRest1)

#histogram for values without 1
hist(MetWit1DDmovement1$timediff, breaks = 35)

MetWit1DDmovement1<-MetWit1DDmovement1%>%
  rename(Spider1movement=timediff)%>%
  mutate(number=row_number())

MetWit1DDmovement1
```

```{r}
#MetWit1DDclean Spider 2
for (i in seq(nrow(MetWit1DDclean)-2)) {
  if (MetWit1DDclean$Monitor.1.Spider.2[i] == 1 & 
        MetWit1DDclean$Monitor.1.Spider.2[i+2] == 1 &
        MetWit1DDclean$Monitor.1.Spider.2[i+1] == 0) {
    MetWit1DDclean$Monitor.1.Spider.2[i+1] <- 1
  }
}

#start time
MetWit1DDrestToMove2<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.2,Date.Time)%>%
  filter(Monitor.1.Spider.2-lag(Monitor.1.Spider.2)>=1)%>%
  rename(startTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(startLight=Light)

#function that shows from Move to Rest ( the minute where there is no movement)
#stop time
MetWit1DDmoveToRest2<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.2,Date.Time)%>%
  filter(Monitor.1.Spider.2-lag(Monitor.1.Spider.2)<0)%>%
  rename(stopTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(stopLight=Light)

#uses the function calculatingTimeDiff to find the time difference and filter values and stores as another data frame
MetWit1DDmovement2<-calculatingTimeDiff(MetWit1DDrestToMove2, MetWit1DDmoveToRest2)

#histogram for values without 1
hist(MetWit1DDmovement2$timediff, breaks = 35)

MetWit1DDmovement2<-MetWit1DDmovement2%>%
  rename(Spider2movement=timediff)%>%
  mutate(number=row_number())

MetWit1DDmovement2
```

```{r}
#MetWit1DDclean Spider 3
for (i in seq(nrow(MetWit1DDclean)-2)) {
  if (MetWit1DDclean$Monitor.1.Spider.3[i] == 1 & 
        MetWit1DDclean$Monitor.1.Spider.3[i+2] == 1 &
        MetWit1DDclean$Monitor.1.Spider.3[i+1] == 0) {
    MetWit1DDclean$Monitor.1.Spider.3[i+1] <- 1
  }
}

#start time
MetWit1DDrestToMove3<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.3,Date.Time)%>%
  filter(Monitor.1.Spider.3-lag(Monitor.1.Spider.3)>=1)%>%
  rename(startTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(startLight=Light)

#function that shows from Move to Rest ( the minute where there is no movement)
#stop time
MetWit1DDmoveToRest3<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.3,Date.Time)%>%
  filter(Monitor.1.Spider.3-lag(Monitor.1.Spider.3)<0)%>%
  rename(stopTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(stopLight=Light)

#uses the function calculatingTimeDiff to find the time difference and filter values and stores as another data frame
MetWit1DDmovement3<-calculatingTimeDiff(MetWit1DDrestToMove3, MetWit1DDmoveToRest3)

#histogram for values without 1
hist(MetWit1DDmovement3$timediff, breaks = 35)

MetWit1DDmovement3<-MetWit1DDmovement3%>%
  rename(Spider3movement=timediff)%>%
  mutate(number=row_number())

MetWit1DDmovement3
```

```{r}
#MetWit1DDclean Spider 4
for (i in seq(nrow(MetWit1DDclean)-2)) {
  if (MetWit1DDclean$Monitor.1.Spider.4[i] == 1 & 
        MetWit1DDclean$Monitor.1.Spider.4[i+2] == 1 &
        MetWit1DDclean$Monitor.1.Spider.4[i+1] == 0) {
    MetWit1DDclean$Monitor.1.Spider.4[i+1] <- 1
  }
}

#start time
MetWit1DDrestToMove4<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.4,Date.Time)%>%
  filter(Monitor.1.Spider.4-lag(Monitor.1.Spider.4)>=1)%>%
  rename(startTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(startLight=Light)

#function that shows from Move to Rest ( the minute where there is no movement)
#stop time
MetWit1DDmoveToRest4<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.4,Date.Time)%>%
  filter(Monitor.1.Spider.4-lag(Monitor.1.Spider.4)<0)%>%
  rename(stopTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(stopLight=Light)

#uses the function calculatingTimeDiff to find the time difference and filter values and stores as another data frame
MetWit1DDmovement4<-calculatingTimeDiff(MetWit1DDrestToMove4, MetWit1DDmoveToRest4)

#histogram for values without 1
hist(MetWit1DDmovement4$timediff, breaks = 35)

MetWit1DDmovement4<-MetWit1DDmovement4%>%
  rename(Spider4movement=timediff)%>%
  mutate(number=row_number())

MetWit1DDmovement4

```

```{r}
#MetWit1DDclean Spider 5
for (i in seq(nrow(MetWit1DDclean)-2)) {
  if (MetWit1DDclean$Monitor.1.Spider.5[i] == 1 & 
        MetWit1DDclean$Monitor.1.Spider.5[i+2] == 1 &
        MetWit1DDclean$Monitor.1.Spider.5[i+1] == 0) {
    MetWit1DDclean$Monitor.1.Spider.5[i+1] <- 1
  }
}

#start time
MetWit1DDrestToMove5<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.5,Date.Time)%>%
  filter(Monitor.1.Spider.5-lag(Monitor.1.Spider.5)>=1)%>%
  rename(startTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(startLight=Light)

#function that shows from Move to Rest ( the minute where there is no movement)
#stop time
MetWit1DDmoveToRest5<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.5,Date.Time)%>%
  filter(Monitor.1.Spider.5-lag(Monitor.1.Spider.5)<0)%>%
  rename(stopTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(stopLight=Light)

#uses the function calculatingTimeDiff to find the time difference and filter values and stores as another data frame
MetWit1DDmovement5<-calculatingTimeDiff(MetWit1DDrestToMove5, MetWit1DDmoveToRest5)

#histogram for values without 1
hist(MetWit1DDmovement5$timediff, breaks = 35)

MetWit1DDmovement5<-MetWit1DDmovement5%>%
  rename(Spider5movement=timediff)%>%
  mutate(number=row_number())

MetWit1DDmovement5

```

```{r}
#MetWit1DDclean Spider 6
for (i in seq(nrow(MetWit1DDclean)-2)) {
  if (MetWit1DDclean$Monitor.1.Spider.6[i] == 1 & 
        MetWit1DDclean$Monitor.1.Spider.6[i+2] == 1 &
        MetWit1DDclean$Monitor.1.Spider.6[i+1] == 0) {
    MetWit1DDclean$Monitor.1.Spider.6[i+1] <- 1
  }
}

#start time
MetWit1DDrestToMove6<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.6,Date.Time)%>%
  filter(Monitor.1.Spider.6-lag(Monitor.1.Spider.6)>=1)%>%
  rename(startTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(startLight=Light)

#function that shows from Move to Rest ( the minute where there is no movement)
#stop time
MetWit1DDmoveToRest6<-MetWit1DDclean%>%
  select(Light, Monitor.1.Spider.6,Date.Time)%>%
  filter(Monitor.1.Spider.6-lag(Monitor.1.Spider.6)<0)%>%
  rename(stopTime=Date.Time)%>%
  mutate(number=row_number())%>%
  rename(stopLight=Light)

#uses the function calculatingTimeDiff to find the time difference and filter values and stores as another data frame
MetWit1DDmovement6<-calculatingTimeDiff(MetWit1DDrestToMove6, MetWit1DDmoveToRest6)

#histogram for values without 1
hist(MetWit1DDmovement6$timediff, breaks = 35)

MetWit1DDmovement6<-MetWit1DDmovement6%>%
  rename(Spider6movement=timediff)%>%
  mutate(number=row_number())

MetWit1DDmovement6

```

```{r}
#creating a new data frame of all movements
dflist<-list(MetWit1DDmovement1,MetWit1DDmovement2,MetWit1DDmovement3, MetWit1DDmovement4,MetWit1DDmovement5,MetWit1DDmovement6)
MetWit1DDmovements<-Reduce(function(x, y) merge(x, y, all=TRUE), dflist, accumulate=FALSE)

#removing the number column that was used to join
MetWit1DDmovements<-MetWit1DDmovements%>%
  select(-number)
MetWit1DDmovements

#graphing all of the spiders together in 1 df
mylist<-list(MetWit1DDmovements)
lst2 <- unlist(mylist, use.names = FALSE)
hist(lst2,breaks=100)

```

clean up my code a little
make my histograms better labelled 
headings, subheadings, graphs shouldl look nice
put on github (update resume)



















#bad code
```{r}
#function to find when spiders go from resting to moving

```

```{r}

```



Run code on the new datasets and create histograms for run-time.
Create a large histogram by combining spider run-times to see overall distribution.
Stitch together run-times into a new dataframe to create a new csv file.


```{r}
MetWit1LD<-MetWit1LD%>%
  select(-Date.Time, -Date, -Time, -Light)
#attempt to loop through the columns so it makes it easier to use...
for (j in colnames(MetWit1LD)){
  for (i in seq(nrow(MetWit1LD)-2)){
    if (MetWit1LD$j[i] ==1 &
        MetWit1LD$j[i+2] ==1 &
        MetWit1LD$j[i+1]==0){
      MetWit1LD$j[i+1] <- 1
    }
  }
}
```
for (i in seq(nrow(MetWit)-2)) {
  if (MetWit$Monitor.1.Spider.31[i] == 1 & 
        MetWit$Monitor.1.Spider.31[i+2] == 1 &
        MetWit$Monitor.1.Spider.31[i+1] == 0) {
    MetWit$Monitor.1.Spider.31[i+1] <- 1
  }
  
}
